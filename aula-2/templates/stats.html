<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Estat√≠stica para Redes Neurais</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') if 'style.css' in list_files_in_static else 'about:blank' }}">
    <style>
        /* Copiando alguns estilos b√°sicos do index.html para funcionar sem um CSS externo */
        body { font-family: 'Segoe UI', sans-serif; margin: 20px 40px; line-height: 1.6; }
        h1, h2 { color: #007BFF; border-bottom: 2px solid #007BFF; padding-bottom: 5px; }
        .box { background: #fff; padding: 15px 20px; margin-bottom: 20px; border: 1px solid #e0e0e0; border-left: 5px solid #007BFF; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .main-content { display: flex; gap: 40px; align-items: flex-start; }
        .controls { flex: 1; }
        .visualization { flex: 2; }
        input[type="range"] { width: 100%; }
        label { font-weight: bold; }
        button { background-color: #007BFF; color: white; padding: 10px 20px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .results-box { background: #f9f9f9; padding: 15px; border-radius: 5px; text-align: center; }
        .results-box h3 { border: none; margin-top: 0; }
        .results-box p { font-size: 1.5rem; font-weight: bold; color: #333; margin: 0; }
    </style>
</head>
<body>

    <h1>üìä M√©dia, Vari√¢ncia e Inicializa√ß√£o de Pesos</h1>

    <div class="box">
        <p>A forma como os pesos de uma rede s√£o inicializados √© crucial. Geralmente, usamos uma <strong>distribui√ß√£o normal</strong> com <strong>m√©dia (Œº) zero</strong> e uma <strong>vari√¢ncia (œÉ¬≤) pequena e controlada</strong>. Explore como esses par√¢metros afetam a distribui√ß√£o dos pesos.</p>
    </div>

    <div class="main-content">
        <div class="controls box">
            <h2>Par√¢metros da Distribui√ß√£o</h2>
            <form method="POST">
                <div>
                    <label for="num_weights">N√∫mero de Pesos: <span id="num_weights_val">{{ num_weights }}</span></label>
                    <input type="range" id="num_weights" name="num_weights" min="10" max="2000" value="{{ num_weights }}" oninput="document.getElementById('num_weights_val').textContent = this.value">
                </div>
                <br>
                <div>
                    <label for="mean_param">M√©dia (Œº): <span id="mean_param_val">{{ mean_param }}</span></label>
                    <input type="range" id="mean_param" name="mean_param" min="-2" max="2" step="0.1" value="{{ mean_param }}" oninput="document.getElementById('mean_param_val').textContent = this.value">
                </div>
                <br>
                <div>
                    <label for="std_dev_param">Desvio Padr√£o (œÉ): <span id="std_dev_param_val">{{ std_dev_param }}</span></label>
                    <input type="range" id="std_dev_param" name="std_dev_param" min="0.1" max="3" step="0.1" value="{{ std_dev_param }}" oninput="document.getElementById('std_dev_param_val').textContent = this.value">
                </div>
                <br>
                <button type="submit">Gerar e Visualizar</button>
            </form>
        </div>

        <div class="visualization box">
            <h2>Resultados</h2>
            <div class="results-grid">
                <div class="results-box">
                    <h3>M√©dia Amostral</h3>
                    <p>{{ "%.4f"|format(sample_mean) }}</p>
                </div>
                <div class="results-box">
                    <h3>Vari√¢ncia Amostral</h3>
                    <p>{{ "%.4f"|format(sample_variance) }}</p>
                </div>
            </div>
            <div id="histogram-plot"></div>
        </div>
    </div>

    <hr style="margin-top: 40px; margin-bottom: 40px;">

    <h1>üí° A Distribui√ß√£o Normal em A√ß√£o nas Ativa√ß√µes</h1>

    <div class="box">
        <p>A entrada linear de um neur√¥nio (z) √© a soma ponderada de m√∫ltiplas entradas. Pelo <strong>Teorema do Limite Central</strong>, mesmo que as entradas n√£o sigam uma distribui√ß√£o normal, a distribui√ß√£o de 'z' tender√° a uma <strong>curva de sino</strong>. Veja abaixo como isso acontece e como a fun√ß√£o de ativa√ß√£o <strong>ReLU</strong> (Rectified Linear Unit) transforma essa distribui√ß√£o.</p>
    </div>

    <div class="main-content">
        <div class="visualization box" style="flex: 1;">
            <h2>Distribui√ß√£o das Pr√©-Ativa√ß√µes (z)</h2>
            <p>Observe a forma√ß√£o da curva de sino.</p>
            <div id="pre-activation-plot"></div>
        </div>
        <div class="visualization box" style="flex: 1;">
            <h2>Distribui√ß√£o das Ativa√ß√µes (a = ReLU(z))</h2>
            <p>A ReLU zera todos os valores negativos, "cortando" a cauda esquerda da distribui√ß√£o.</p>
            <div id="activation-plot"></div>
        </div>
    </div>


    <hr style="margin-top: 40px; margin-bottom: 40px;">

    <h1>üß† Teorema de Bayes e Classifica√ß√£o</h1>

    <div class="box">
        <p>O Teorema de Bayes √© uma f√≥rmula para atualizar nossas cren√ßas √† luz de novas evid√™ncias. Ele √© a base do racioc√≠nio probabil√≠stico e de √°reas avan√ßadas como as Redes Neurais Bayesianas.</p>
        <p>A intui√ß√£o √©: <strong>Cren√ßa Final (Posterior) = For√ßa da Evid√™ncia (Likelihood) √ó Cren√ßa Inicial (Prior)</strong></p>
        <ul>
            <li><strong>Prior P(A):</strong> A probabilidade de algo ser verdade ANTES de qualquer evid√™ncia. Ex: A preval√™ncia de uma doen√ßa na popula√ß√£o.</li>
            <li><strong>Likelihood P(B|A):</strong> A probabilidade da evid√™ncia ocorrer, DADO que nossa hip√≥tese √© verdadeira. <strong>A sa√≠da de uma rede neural √© uma forma de Likelihood.</strong></li>
            <li><strong>Posterior P(A|B):</strong> A probabilidade da nossa hip√≥tese ser verdadeira, DEPOIS de considerar a evid√™ncia. √â o resultado que realmente nos interessa.</li>
        </ul>
    </div>

    <div class="box">
        <h2>üß™ Calculadora Bayesiana Interativa: Cen√°rio de Diagn√≥stico M√©dico</h2>
        <p>Imagine um exame (criado com uma Rede Neural) para uma doen√ßa rara. Mexa nos sliders e veja como a probabilidade real muda drasticamente.</p>

        <div class="main-content">
            <div class="controls" style="flex: 1.5;">
                <h4>1. Defina a Cren√ßa Inicial (Prior)</h4>
                <label for="prior">Preval√™ncia da Doen√ßa na Popula√ß√£o: <strong id="prior_val">1%</strong></label>
                <input type="range" id="prior" min="0.1" max="50" step="0.1" value="1">

                <h4 style="margin-top: 20px;">2. Defina a Acur√°cia do Exame (Likelihoods)</h4>
                <label for="sensitivity">Sensibilidade (P(Teste `+` | Doente)): <strong id="sensitivity_val">99%</strong></label>
                <input type="range" id="sensitivity" min="50" max="100" step="1" value="99">
                <small><i>A capacidade do teste de detectar a doen√ßa corretamente.</i></small>
                <br><br>
                <label for="fpr">Taxa de Falsos Positivos (P(Teste `+` | N√£o Doente)): <strong id="fpr_val">5%</strong></label>
                <input type="range" id="fpr" min="1" max="50" step="1" value="5">
                <small><i>A chance do teste errar e dar positivo em uma pessoa saud√°vel.</i></small>
            </div>

            <div class="visualization" style="flex: 1; text-align: center; background: #f0f8ff; padding: 20px; border-radius: 10px;">
                <h3>Resultado Final (Posterior)</h3>
                <p style="margin-top: 10px;">Dado que um paciente aleat√≥rio testou <strong>POSITIVO</strong>...</p>
                <p style="font-size: 1.2em;">A probabilidade real dele estar doente √© de:</p>
                <p id="posterior_result" style="font-size: 3.5rem; color: #d9534f; font-weight: bold; margin-top: 10px;">16.8%</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
        // Pega os dados dos pesos gerados pelo Flask
        const weightsData = {{ weights_data | tojson }};

        // Cria o tra√ßo do histograma para o Plotly
        const trace = {
            x: weightsData,
            type: 'histogram',
            marker: {
                color: 'rgba(0, 123, 255, 0.7)',
                line: {
                    color: 'rgba(0, 123, 255, 1)',
                    width: 1
                }
            },
            // Mostra a contagem normalizada para parecer uma distribui√ß√£o de probabilidade
            histnorm: 'probability density'
        };

        const layout = {
            title: 'Distribui√ß√£o dos Pesos Gerados',
            xaxis: { title: 'Valor do Peso' },
            yaxis: { title: 'Densidade de Probabilidade' },
            bargap: 0.05
        };

        // Desenha o gr√°fico na div 'histogram-plot'
        Plotly.newPlot('histogram-plot', [trace], layout);

    // Pega os novos dados gerados pelo Flask
        const preActivationsData = {{ pre_activations_data | tojson }};
        const activationsData = {{ activations_data | tojson }};

        // Cria o gr√°fico para as pr√©-ativa√ß√µes (z)
        const trace_z = {
            x: preActivationsData,
            type: 'histogram',
            marker: { color: 'rgba(44, 160, 44, 0.7)' }, // Verde
            histnorm: 'probability density'
        };
        const layout_z = {
            title: 'Distribui√ß√£o de Z (Pr√©-Ativa√ß√£o)',
            xaxis: { title: 'Valor de Z' },
            yaxis: { title: 'Densidade' }
        };
        Plotly.newPlot('pre-activation-plot', [trace_z], layout_z);


        // Cria o gr√°fico para as ativa√ß√µes (a)
        const trace_a = {
            x: activationsData,
            type: 'histogram',
            marker: { color: 'rgba(214, 39, 40, 0.7)' }, // Vermelho
            histnorm: 'probability density'
        };
        const layout_a = {
            title: 'Distribui√ß√£o de A (P√≥s-ReLU)',
            xaxis: { title: 'Valor de A' },
            yaxis: { title: 'Densidade' }
        };
        Plotly.newPlot('activation-plot', [trace_a], layout_a);

        // Pega os elementos do HTML
        const priorSlider = document.getElementById('prior');
        const sensitivitySlider = document.getElementById('sensitivity');
        const fprSlider = document.getElementById('fpr');

        const priorValEl = document.getElementById('prior_val');
        const sensitivityValEl = document.getElementById('sensitivity_val');
        const fprValEl = document.getElementById('fpr_val');
        const posteriorResultEl = document.getElementById('posterior_result');

        function updateBayesCalculation() {
            // 1. L√™ os valores atuais dos sliders e converte para probabilidades (0 a 1)
            const p_doente = parseFloat(priorSlider.value) / 100; // Prior
            const p_teste_pos_dado_doente = parseFloat(sensitivitySlider.value) / 100; // Likelihood (Sensibilidade)
            const p_teste_pos_dado_nao_doente = parseFloat(fprSlider.value) / 100; // Likelihood (Falso Positivo)

            // Atualiza os textos dos labels
            priorValEl.textContent = `${priorSlider.value}%`;
            sensitivityValEl.textContent = `${sensitivitySlider.value}%`;
            fprValEl.textContent = `${fprSlider.value}%`;

            // 2. Calcula os outros termos necess√°rios para a f√≥rmula de Bayes
            const p_nao_doente = 1 - p_doente;

            // 3. Aplica o Teorema de Bayes: P(Doente | Teste +)
            // Numerador = P(Teste + | Doente) * P(Doente)
            const numerator = p_teste_pos_dado_doente * p_doente;

            // Denominador (Evid√™ncia Total) = P(Teste +)
            // P(Teste +) = P(Teste + | Doente)*P(Doente) + P(Teste + | N√£o Doente)*P(N√£o Doente)
            const denominator = (p_teste_pos_dado_doente * p_doente) + (p_teste_pos_dado_nao_doente * p_nao_doente);

            // Posterior
            const posterior = numerator / denominator;

            // 4. Exibe o resultado formatado como porcentagem
            posteriorResultEl.textContent = `${(posterior * 100).toFixed(1)}%`;
        }

        // Adiciona "escutadores" de eventos para cada slider.
        // A fun√ß√£o ser√° chamada toda vez que um slider for movido.
        priorSlider.addEventListener('input', updateBayesCalculation);
        sensitivitySlider.addEventListener('input', updateBayesCalculation);
        fprSlider.addEventListener('input', updateBayesCalculation);

        // Chama a fun√ß√£o uma vez no in√≠cio para calcular com os valores padr√£o
        updateBayesCalculation();
    </script>
</body>
</html>